<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Deposits in the Wild | Collin J. Schwantes </title> <meta name="author" content="Collin J. Schwantes"> <meta name="description" content="A blog post about using the R package deposits"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <meta property="og:site_name" content="Collin J. Schwantes"> <meta property="og:type" content="article"> <meta property="og:title" content="Collin J. Schwantes | Deposits in the Wild"> <meta property="og:url" content="https://collinschwantes.github.io/blog/2024/deposits-in-the-wild/"> <meta property="og:description" content="A blog post about using the R package deposits"> <meta property="og:locale" content="en"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="Deposits in the Wild"> <meta name="twitter:description" content="A blog post about using the R package deposits"> <script type="application/ld+json">
    {
        "author":
        {
            "@type": "Person",
            "name": "Collin J. Schwantes"
        },
        "url": "https://collinschwantes.github.io/blog/2024/deposits-in-the-wild/",
        "@type": "BlogPosting",
        "description": "A blog post about using the R package deposits",
        "headline": "Deposits in the Wild",
        
        "sameAs": ["https://orcid.org/0000-0002-9882-941X", "https://osf.io/a752m/", "https://github.com/collinschwantes", "https://fosstodon.org/@collinschwantes", "https://www.zotero.org/cschwantes"],
        
        "name": "Collin J. Schwantes",
        "@context": "https://schema.org"
    }
  </script> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/cjs.svg?c95653ea8ad807f15cbf38ec20d20f68"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://collinschwantes.github.io/blog/2024/deposits-in-the-wild/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Collin</span> J. Schwantes </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Deposits in the Wild</h1> <p class="post-meta"> Created in August 30, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/deposits"> <i class="fa-solid fa-hashtag fa-sm"></i> deposits</a>   <a href="/blog/tag/zenodo"> <i class="fa-solid fa-hashtag fa-sm"></i> zenodo</a>   <a href="/blog/tag/fair"> <i class="fa-solid fa-hashtag fa-sm"></i> FAIR</a>   <a href="/blog/tag/data"> <i class="fa-solid fa-hashtag fa-sm"></i> data</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>This blog post has been published on the <a href="https://ropensci.org/blog/2024/09/17/deposits-in-the-wild/" rel="external nofollow noopener" target="_blank">ROpenSci blog</a></p> <p>For the better part of a year, I have been looking for an opportunity to use the ROpenSci package <a href="https://docs.ropensci.org/deposits/" rel="external nofollow noopener" target="_blank">{deposits}</a> in my role as the Data Librarian at EcoHealth Alliance. I had done some initial testing with the Mark Padgham, the brilliant person who developed this package, but there weren’t any projects ready for me to put {deposits} through its paces. Enter the <em>Rift Valley Fever Virus in South Africa</em> project, a ten year, multiple part study of humans, wildlife (mosquitoes and wild ungulates), and domestic animals that uses every data store from dropbox to Google drive to Airtable to ODK with a healthy mix file formats for tabular data. Additionally, the PIs on the project are very enthusiastic about making the data FAIR.</p> <p>The team and I put together workflow in <a href="https://books.ropensci.org/targets/" rel="external nofollow noopener" target="_blank">{targets}</a> with the mechanics of ETL largely handled by our <a href="https://ecohealthalliance.github.io/ohcleandat/" rel="external nofollow noopener" target="_blank">{ohcleandat}</a> package. The underlying philosophy of the ETL process is the original data are only lightly modified (stripping white spaces, column names to snake case, etc) while humans do any cleaning that requires thought via validation logs. Changes made in logs are then applied to the data before they are integrated into various larger workpackages. Those workpackages are then deposited into Zenodo to create versioned single sources of truth with digital object identifiers.</p> <pre><code class="language-mermaid">flowchart LR
    A[Dropbox] --&gt; E(ETL in targets with ohcleandat)
    B[GoogleDrive] --&gt; E
    C[Airtable] --&gt; E
    D[ODK] --&gt; E
    J[Validation Logs] --&gt; E
    E --&gt; J
    E --&gt; F[Cleaned Integrated Data]  
    F --&gt; G(Prep for Archive in targets with deposits)
    G --&gt; H{Zenodo}
</code></pre> <h2 id="an-abbreviated-intro-to-deposits">An abbreviated intro to {deposits}</h2> <p>The first thing you have to know about {deposits} is that it uses the R6 class. R6 is an object oriented framework where each class of object has a set of methods (functions) that can be applied to it. This is really nice because you can access all of the available methods of a <code class="language-plaintext highlighter-rouge">depositClient</code> object by using <code class="language-plaintext highlighter-rouge">cli$SOME_METHOD()</code> - where its less convenient for people who work in Rstudio is when you’re looking for the help page for <code class="language-plaintext highlighter-rouge">SOME_METHOD</code> - instead you have to look for <code class="language-plaintext highlighter-rouge">depositClient</code> and scroll to the link to <code class="language-plaintext highlighter-rouge">SOME_METHOD</code>.</p> <p>The next kind of tricky thing is <a href="https://docs.ropensci.org/deposits/articles/install-setup.html#setup-api-tokens" rel="external nofollow noopener" target="_blank">adding api tokens to the environment</a>. This can be done in a number of different ways (<a href="https://ecohealthalliance.github.io/eha-ma-handbook/16-encryption.html" rel="external nofollow noopener" target="_blank">encrypted .env file</a>, <a href="https://usethis.r-lib.org/reference/edit.html" rel="external nofollow noopener" target="_blank">usethis::edit_r_environ</a>, etc) but is essential to using this package. Remember that these tokens are sensitive credentials and should not be openly shared.</p> <p>{deposits} works as an intermediary between a remote service (<a href="https://zenodo.org/" rel="external nofollow noopener" target="_blank">Zenodo</a> or <a href="https://figshare.com/" rel="external nofollow noopener" target="_blank">Figshare</a>) and your local machine. Via {deposits} you can create, read, update, or delete items on a remote service.</p> <pre><code class="language-mermaid">flowchart LR
    A[Local storage] &lt;--&gt; B{depositsClient}
    B &lt;--&gt; C[Zenodo/Figshare]
</code></pre> <p>{deposits} allows you to pre-populate the metadata for those items. This is incredibly useful if you have to deposit many items with similar metadata, if you have highly collaborative items with dozens of co-authors/contributors, or if you want to update many items with the same bit of metadata. You might be asking yourself - do Zenodo and Figshare really use the same terms with the same properties in their APIs? The answer is no, but they both use flavors of <a href="https://www.dublincore.org/specifications/dublin-core/dcmi-terms/#section-1" rel="external nofollow noopener" target="_blank">Dublin Core</a> that Mark has mapped to common standard. {deposits} uses JSON validation to enforce the standard and the package also provides a template properly formatted metadata.</p> <p>Finally, {deposits} allows you to push items to a service and publish them. On zenodo, you may push items up as embargoed or open (restricted is coming soon pending a pull request).</p> <h2 id="what-does-our-workflow-look-like">What does our workflow look like?</h2> <p>We created a <code class="language-plaintext highlighter-rouge">deposits_metadata.csv</code> that contains all of the DCMI terms we would like to pre-populate across ~35 zenodo deposits. Because certain DCMI terms like creator can have multiple attributes, we augmented the <code class="language-plaintext highlighter-rouge">deposits_metadata.csv</code> with a <code class="language-plaintext highlighter-rouge">creator_metadata.csv</code> file that contains additional terms. I opted to use csv files because 1) they are very easy to maintain, 2) the are extremely interoperable, 3) we have a very limited number of tables. If there were additional tables to link or more complicated relationships I would use a relational database like MySQL (or Airtable).</p> <pre><code class="language-mermaid">flowchart LR

    A[Deposit Metadata CSV] --&gt; G(Prep for Archive in targets with deposits)
    B[Creator Metadata CSV] --&gt; G
    C[ Data Files]  --&gt; G
    G --&gt; H{Zenodo}
</code></pre> <p><code class="language-plaintext highlighter-rouge">deposits_metadata.csv</code></p> <table> <thead> <tr> <th>title</th> <th>format</th> <th>created</th> <th>creator</th> <th>files</th> <th>…</th> </tr> </thead> <tbody> <tr> <td>Work package 1</td> <td>dataset</td> <td>2024-09-01</td> <td>“Collin, Mindy, Johana”</td> <td>“dat1.csv, dat2.csv”</td> <td>…</td> </tr> </tbody> </table> <p>Each row in <code class="language-plaintext highlighter-rouge">deposits_metadata.csv</code> corresponds to a work package - a collection of data files that will become a deposit. The PIs on the project requested access to raw, semi-clean, and clean versions of the data. They also provided lists of who should be credited for what and who should have access to what. Unfortunately in Zenodo you cannot restrict access to specific files like you can in OSF, so a different deposit has to be made for each group that needs access.</p> <p>We then map over each row in the dataset in {targets} using <a href="https://docs.ropensci.org/targets/reference/tar_group.html" rel="external nofollow noopener" target="_blank">the group iterator</a> to create the draft deposits that we need. The <code class="language-plaintext highlighter-rouge">depositClient</code> plays very nicely with targets, and can even be tar_loaded when you need to interactively debug.</p> <p>Another important component of our workflow is generating codebooks/data dictionaries/structural metadata for the different work packages. By default, {deposits} creates a {frictionless} data package that describes all the files/resources in a deposit. The <code class="language-plaintext highlighter-rouge">datapackage.json</code> file contains a minimal description of the different files that contains the field name and field type. We can augment this with field descriptions, term URIs, or any number of additional attributes that would helpful when describing the data.<br> To do this, we use <code class="language-plaintext highlighter-rouge">ohcleandat::create_structural_metadata</code> and <code class="language-plaintext highlighter-rouge">ohcleandat::update_structural_metadata</code> to create/update the codebooks then <code class="language-plaintext highlighter-rouge">ohcleandat::expand_frictionless_metadata()</code> to add those elements to <code class="language-plaintext highlighter-rouge">datapackage.json</code>. Because each deposit contains multiple data files and multiple codebook files, we have to iteratively <code class="language-plaintext highlighter-rouge">purrr::walk</code> over them to properly update the data.</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">#' purrr::walk over ohcleandat::expand_frictionless_metadata</span><span class="w">
</span><span class="cd">#'</span><span class="w">
</span><span class="cd">#' @param file_paths List with the elements data and codebook</span><span class="w">
</span><span class="cd">#'</span><span class="w">
</span><span class="cd">#' @return Invisible. writes updated datapackage.json</span><span class="w">
</span><span class="cd">#' @export</span><span class="w">
</span><span class="cd">#'</span><span class="w">
</span><span class="cd">#' @examples</span><span class="w">
</span><span class="n">walk_expand_frictionless_metadata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">file_paths</span><span class="p">,</span><span class="n">dir_path</span><span class="p">){</span><span class="w">
  </span><span class="n">purrr</span><span class="o">::</span><span class="n">walk2</span><span class="p">(</span><span class="n">file_paths</span><span class="o">$</span><span class="n">codebook</span><span class="p">,</span><span class="n">file_paths</span><span class="o">$</span><span class="n">data</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">codebook_path</span><span class="p">,</span><span class="n">data_path</span><span class="p">){</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">codebook_path</span><span class="p">)){</span><span class="w">
      </span><span class="n">msg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"No codebook listed for %s"</span><span class="p">,</span><span class="n">data_path</span><span class="p">)</span><span class="w">
      </span><span class="nf">return</span><span class="p">(</span><span class="kc">NA</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
    </span><span class="n">codebook_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readr</span><span class="o">::</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">codebook_path</span><span class="p">)</span><span class="w">
    </span><span class="c1">## check dataset_name matches resource_name</span><span class="w">
    </span><span class="n">resource_name</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_resource_name</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span><span class="w">
    
    </span><span class="k">if</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">codebook_df</span><span class="o">$</span><span class="n">dataset_name</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">resource_name</span><span class="p">){</span><span class="w">
      </span><span class="n">msg</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"resource_name and dataset_name do not match. 

Check that the proper name was added to the codebook and that
the files are in the proper order in deposits_metadata.csv. 
resource_name is taken from the file name for a given dataset.

%s != %s"</span><span class="p">,</span><span class="w">
                    </span><span class="n">resource_name</span><span class="p">,</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">codebook_df</span><span class="o">$</span><span class="n">dataset_name</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">
      
      </span><span class="n">stop</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
    </span><span class="n">data_package_path</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%s/datapackage.json"</span><span class="p">,</span><span class="n">dir_path</span><span class="p">)</span><span class="w">
    
    
    </span><span class="n">ohcleandat</span><span class="o">::</span><span class="n">expand_frictionless_metadata</span><span class="p">(</span><span class="n">structural_metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">codebook_df</span><span class="p">,</span><span class="w">
                                             </span><span class="n">resource_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resource_name</span><span class="p">,</span><span class="w"> </span><span class="c1"># name of the file with no extension</span><span class="w">
                                             </span><span class="n">resource_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_path</span><span class="p">,</span><span class="w">
                                             </span><span class="n">data_package_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_package_path</span><span class="p">)</span><span class="w">
  </span><span class="p">})</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>When we go to add this updated <code class="language-plaintext highlighter-rouge">datapackage.json</code> file to the deposit, the order of operations matters. If we are creating an item, the function might look like this:</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">#' Create Zenodo Deposit and Expand Metadata</span><span class="w">
</span><span class="cd">#'</span><span class="w">
</span><span class="cd">#' @param cli deposits client</span><span class="w">
</span><span class="cd">#' @param metadata_dcmi_complete list of DCMI metadata terms</span><span class="w">
</span><span class="cd">#' @param file_paths paths to data files</span><span class="w">
</span><span class="cd">#' @param dir_path path to directory where workpackage files are stored locally</span><span class="w">
</span><span class="cd">#'</span><span class="w">
</span><span class="cd">#' @return updated deposits client</span><span class="w">
</span><span class="cd">#' @export</span><span class="w">
</span><span class="cd">#'</span><span class="w">
</span><span class="cd">#' @examples</span><span class="w">
</span><span class="n">create_zenodo_deposit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">cli</span><span class="p">,</span><span class="n">metadata_dcmi_complete</span><span class="p">,</span><span class="w"> </span><span class="n">file_paths</span><span class="p">,</span><span class="n">dir_path</span><span class="p">){</span><span class="w">
  
  
  </span><span class="c1">## populate descriptive metadata for zenodo</span><span class="w">

  </span><span class="n">cli</span><span class="o">$</span><span class="n">deposit_fill_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metadata_dcmi_complete</span><span class="p">)</span><span class="w">
  
  </span><span class="n">cli</span><span class="o">$</span><span class="n">deposit_new</span><span class="p">(</span><span class="n">prereserve_doi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  
  </span><span class="c1">## add resources - adds everything in dir_path</span><span class="w">
  </span><span class="n">cli</span><span class="o">$</span><span class="n">deposit_add_resource</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dir_path</span><span class="p">)</span><span class="w">

  </span><span class="c1">#upload files  </span><span class="w">
  </span><span class="n">cli</span><span class="o">$</span><span class="n">deposit_upload_file</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dir_path</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># expand structural metadata</span><span class="w">
  </span><span class="n">walk_expand_frictionless_metadata</span><span class="p">(</span><span class="n">file_paths</span><span class="p">,</span><span class="n">dir_path</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># update structural metadata - has to be done in this order or datapackage.json is re-written on upload</span><span class="w">
  
  </span><span class="n">cli</span><span class="o">$</span><span class="n">deposit_update</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dir_path</span><span class="p">)</span><span class="w">
  
  </span><span class="nf">return</span><span class="p">(</span><span class="n">cli</span><span class="p">)</span><span class="w">
  
</span><span class="p">}</span><span class="w">
  
</span></code></pre></div></div> <p>and updating a deposit might look something like:</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">update_zenodo_deposit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">cli</span><span class="p">,</span><span class="w"> </span><span class="n">metadata_updated</span><span class="p">,</span><span class="n">metadata_dcmi_complete</span><span class="p">,</span><span class="w"> </span><span class="n">file_paths</span><span class="p">,</span><span class="w"> </span><span class="n">dir_path</span><span class="p">){</span><span class="w">
  
  
  </span><span class="c1">## retrieve the deposit</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="s2">"getting deposit from id"</span><span class="p">)</span><span class="w">
  </span><span class="n">cli</span><span class="o">$</span><span class="n">deposit_retrieve</span><span class="p">(</span><span class="nf">as.integer</span><span class="p">(</span><span class="n">metadata_updated</span><span class="o">$</span><span class="n">deposit_id</span><span class="p">))</span><span class="w">
  
  </span><span class="n">data_package_path</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%s/datapackage.json"</span><span class="p">,</span><span class="n">dir_path</span><span class="p">)</span><span class="w">
  
  </span><span class="c1">## update descriptive metadata</span><span class="w">
  </span><span class="c1">## don't need to walk over this because there is only one set of descriptive for the data package</span><span class="w">
  </span><span class="c1">## metadata for the deposit</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="s2">"updating descriptive metadata"</span><span class="p">)</span><span class="w">
  </span><span class="n">ohcleandat</span><span class="o">::</span><span class="n">update_frictionless_metadata</span><span class="p">(</span><span class="n">descriptive_metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metadata_dcmi_complete</span><span class="p">,</span><span class="w">
                                           </span><span class="n">data_package_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_package_path</span><span class="w">
  </span><span class="p">)</span><span class="w">
  
  </span><span class="n">cli</span><span class="o">$</span><span class="n">deposit_fill_metadata</span><span class="p">(</span><span class="n">metadata_dcmi_complete</span><span class="p">)</span><span class="w">
  
  </span><span class="c1">## expand metadata</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="s2">"expanding metadata"</span><span class="p">)</span><span class="w">
  </span><span class="n">walk_expand_frictionless_metadata</span><span class="p">(</span><span class="n">file_paths</span><span class="p">,</span><span class="n">dir_path</span><span class="p">)</span><span class="w">
  
  </span><span class="c1">## update the deposit</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="s2">"updating deposit"</span><span class="p">)</span><span class="w">
  </span><span class="n">cli</span><span class="o">$</span><span class="n">deposit_upload_file</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dir_path</span><span class="p">)</span><span class="w">
  
  
  </span><span class="n">print</span><span class="p">(</span><span class="s2">"returning cli"</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">cli</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>We can even keep our <code class="language-plaintext highlighter-rouge">deposits_metadata.csv</code> file updated using the <code class="language-plaintext highlighter-rouge">depositClient</code>.</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">#' Update deposits metadata</span><span class="w">
</span><span class="cd">#' </span><span class="w">
</span><span class="cd">#' Find workpackage titles that match deposit titles </span><span class="w">
</span><span class="cd">#' </span><span class="w">
</span><span class="cd">#' @param cli deposits Client</span><span class="w">
</span><span class="cd">#' @param metadata_formatted dataframe of formatted descriptive metadata</span><span class="w">
</span><span class="cd">#' @return</span><span class="w">
</span><span class="cd">#' @author Collin Schwantes</span><span class="w">
</span><span class="cd">#' @export</span><span class="w">
</span><span class="n">update_zenodo_metadata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">cli</span><span class="p">,</span><span class="w"> </span><span class="n">metadata_formatted</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">

  </span><span class="n">df_doi_id</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">purrr</span><span class="o">::</span><span class="n">map_df</span><span class="p">(</span><span class="n">metadata_formatted</span><span class="o">$</span><span class="n">title</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="w">
        
      </span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">identifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA_character_</span><span class="p">,</span><span class="w"> </span><span class="n">deposit_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA_character_</span><span class="p">)</span><span class="w">
    
      </span><span class="n">deposits_found</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cli</span><span class="o">$</span><span class="n">deposits</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
      </span><span class="n">dplyr</span><span class="o">::</span><span class="n">filter</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
      </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">doi</span><span class="p">)</span><span class="w">
    
    </span><span class="k">if</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">deposits_found</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">){</span><span class="w">
      </span><span class="n">message</span><span class="p">(</span><span class="s2">"No matching items found"</span><span class="p">)</span><span class="w">
      </span><span class="nf">return</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
      
    </span><span class="k">if</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">deposits_found</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="p">){</span><span class="w">
      </span><span class="n">warning</span><span class="p">(</span><span class="s2">"clean up your deposits?"</span><span class="p">)</span><span class="w">
      </span><span class="nf">return</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
      
      </span><span class="n">df</span><span class="o">$</span><span class="n">identifier</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">deposits_found</span><span class="o">$</span><span class="n">doi</span><span class="p">)</span><span class="w">
      </span><span class="n">df</span><span class="o">$</span><span class="n">deposit_id</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">deposits_found</span><span class="o">$</span><span class="n">id</span><span class="p">)</span><span class="w">
    
      </span><span class="nf">return</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
  </span><span class="p">})</span><span class="w">
  
  
  </span><span class="n">metadata_formatted</span><span class="o">$</span><span class="n">identifier</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_doi_id</span><span class="o">$</span><span class="n">identifier</span><span class="w">
  </span><span class="n">metadata_formatted</span><span class="o">$</span><span class="n">deposit_id</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_doi_id</span><span class="o">$</span><span class="n">deposit_id</span><span class="w">

  </span><span class="nf">return</span><span class="p">(</span><span class="n">metadata_formatted</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>We can create many deposits with good descriptive metadata, extend the structural metadata, and keep out deposits_metadata.csv up to date using {deposits}, {ohcleandat}, and a little {dplyr}.</p> <h2 id="potential-pain-points">Potential pain points</h2> <p>1) Some of the more complex DCMI terms require nested lists with very particular structures. This can be hard to reason about if you’re not super familiar with <a href="https://eloquentjavascript.net/04_data.html" rel="external nofollow noopener" target="_blank">JSON</a> or how the <a href="https://arxiv.org/abs/1403.2805" rel="external nofollow noopener" target="_blank">{jsonlite}</a> package converts json to R objects. Mark provides good examples of constructing the <code class="language-plaintext highlighter-rouge">creator</code> objects in the deposits documentation. Even if you are a JSON wizard, the <a href="https://developers.zenodo.org/#entities" rel="external nofollow noopener" target="_blank">entities documentation</a> in the Zenodo API is super helpful.<br> 2) Metadata errors can feel a little cryptic until you get a better understanding of <a href="https://cran.rstudio.com/web/packages/jsonvalidate/vignettes/jsonvalidate.html" rel="external nofollow noopener" target="_blank">JSON validation</a> and stare at the <a href="https://github.com/ropenscilabs/deposits/blob/main/inst/extdata/dc/schema.json" rel="external nofollow noopener" target="_blank">{deposits json schema}</a> for a minute or two. 3) Collaboration can be challenging because drafts have to be manually shared in Zenodo. <code class="language-plaintext highlighter-rouge">¯\_(ツ)_/¯</code>.</p> <h2 id="conclusions">Conclusions</h2> <p>We were able put the deposits package through the wringer with the RVF2 project and it performed extremely well. The {deposits} package is great for making and managing a collection of Zenodo deposits. It takes a second to get the hang of the <code class="language-plaintext highlighter-rouge">R6</code> object oriented structure and JSON data validation, but once you do, the thoughtful package design results in a smooth workflow whether you’re updating a single deposit or a large batch.</p> <pre><code class="language-mermaid">flowchart LR

    A[Deposit Metadata CSV] --&gt; G(Prep for Archive in targets with deposits)
    B[Creator Metadata CSV] --&gt; G
    C[Workpackage Files]  --&gt; G
    G --&gt; H{Zenodo}
    G ---&gt; A
</code></pre> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/cloud-native-gis/">Course on Cloud Native GIS</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/pypackage/">Writing a python package with Hatch and pyOpenSci</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/rix/">Rix with Bruno Rodrigues</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/zero-shot-data-integration/">Zero Shot Data Integration</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Collin J. Schwantes. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: December 02, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10.7.0/dist/mermaid.min.js" integrity="sha256-TtLOdUA8mstPoO6sGvHIGx2ceXrrX4KgIItO06XOn8A=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js" integrity="sha256-1rA678n2xEx7x4cTZ5x4wpUCj6kUMZEZ5cxLSVSFWxw=" crossorigin="anonymous"></script> <script>let mermaidTheme=determineComputedTheme();document.addEventListener("readystatechange",()=>{"complete"===document.readyState&&(document.querySelectorAll("pre>code.language-mermaid").forEach(e=>{const t=e.textContent,d=e.parentElement;d.classList.add("unloaded");let a=document.createElement("pre");a.classList.add("mermaid");const n=document.createTextNode(t);a.appendChild(n),d.after(a)}),mermaid.initialize({theme:mermaidTheme}),"undefined"!=typeof d3&&window.addEventListener("load",function(){d3.selectAll(".mermaid svg").each(function(){var e=d3.select(this);e.html("<g>"+e.html()+"</g>");var t=e.select("g"),d=d3.zoom().on("zoom",function(e){t.attr("transform",e.transform)});e.call(d)})}))});</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?601a2d3465e2a52bec38b600518d5f70"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-publications",title:"publications",description:"publications by categories in reversed chronological order. generated by jekyll-scholar.",section:"Navigation",handler:()=>{window.location.href="/publications/"}},{id:"nav-projects",title:"projects",description:"A growing collection of your cool projects.",section:"Navigation",handler:()=>{window.location.href="/projects/"}},{id:"nav-repositories",title:"repositories",description:"Overview of github activity",section:"Navigation",handler:()=>{window.location.href="/repositories/"}},{id:"nav-cv",title:"cv",description:"This is a description of the page. You can modify it in '_pages/cv.md'. You can also change or remove the top pdf download button.",section:"Navigation",handler:()=>{window.location.href="/cv/"}},{id:"post-course-on-cloud-native-gis",title:"Course on Cloud Native GIS",description:"Notes on cloud native gis",section:"Posts",handler:()=>{window.location.href="/blog/2025/cloud-native-gis/"}},{id:"post-writing-a-python-package-with-hatch-and-pyopensci",title:"Writing a python package with Hatch and pyOpenSci",description:"Notes on writing a python package",section:"Posts",handler:()=>{window.location.href="/blog/2025/pypackage/"}},{id:"post-rix-with-bruno-rodrigues",title:"Rix with Bruno Rodrigues",description:"Notes on R package Rix",section:"Posts",handler:()=>{window.location.href="/blog/2025/rix/"}},{id:"post-zero-shot-data-integration",title:"Zero Shot Data Integration",description:"A blog post about integrating data sight unseen",section:"Posts",handler:()=>{window.location.href="/blog/2024/zero-shot-data-integration/"}},{id:"post-deposits-in-the-wild",title:"Deposits in the Wild",description:"A blog post about using the R package deposits",section:"Posts",handler:()=>{window.location.href="/blog/2024/deposits-in-the-wild/"}},{id:"news-a-simple-inline-announcement",title:"A simple inline announcement.",description:"",section:"News"},{id:"news-a-long-announcement-with-details",title:"A long announcement with details",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_2/"}},{id:"news-a-simple-inline-announcement-with-markdown-emoji-sparkles-smile",title:'A simple inline announcement with Markdown emoji! <img class="emoji" title=":sparkles:" alt=":sparkles:" src="https://github.githubassets.com/images/icons/emoji/unicode/2728.png" height="20" width="20"> <img class="emoji" title=":smile:" alt=":smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png" height="20" width="20">',description:"",section:"News"},{id:"projects-aperol-r-package",title:"Aperol R package",description:"A fun package in R that gives you praise when you most need it",section:"Projects",handler:()=>{window.location.href="/projects/aperol/"}},{id:"projects-working-group-on-nih-dmsp-guidance",title:"Working Group on NIH DMSP Guidance",description:"OSF project page for NIH DMSP WG Guidance",section:"Projects",handler:()=>{window.location.href="/projects/nih_dmsp_wg/"}},{id:"projects-panama-ultra-trail-marathon",title:"Panama Ultra Trail Marathon",description:"I've never cried tears of joy after finishing a run - I did this time.",section:"Projects",handler:()=>{window.location.href="/projects/panama_ultra_marathon/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%63%6A%73%63%68%77%61%6E%74%65%73%4C%4C@%67%6D%61%69%6C.%63%6F%6D","_blank")}},{id:"socials-orcid",title:"ORCID",section:"Socials",handler:()=>{window.open("https://orcid.org/0000-0002-9882-941X","_blank")}},{id:"socials-open-science-framework",title:"Open Science Framework",section:"Socials",handler:()=>{window.open("https://osf.io/a752m/","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/collinschwantes","_blank")}},{id:"socials-mastodon",title:"Mastodon",section:"Socials",handler:()=>{window.open("https://fosstodon.org/@collinschwantes","_blank")}},{id:"socials-zotero",title:"Zotero",section:"Socials",handler:()=>{window.open("https://www.zotero.org/cschwantes","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>